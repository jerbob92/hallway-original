<html>
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript" src="http://static.openheatmap.com/scripts/jquery.openheatmap.js"></script>
<script src='config.js'></script> <!-- optional, used for file:/// desktop development convenience -->
<script src='/static/js/viewer.js'></script> <!-- optional, only loaded when hosted, common locker viewer utilities -->
<script type='text/javascript'>
var map;
var csv;
$(document).ready(function()
{
    $('#openheatmap_container').insertOpenHeatMap({
        width: 1000,
        height: 800,
    type: "density",
  "information_alpha":0.85,
    "gradient_start_color":"#001db0",
    "gradient_mid_color":"#e0e000",
"gradient_with_alpha":["#00000000","#d8001db0","#d8e0e000","#d8ff0000"],
    "gradient_end_color":"#ff0000"
    });

    $.getJSON(baseUrl + '/query/getPlace',{terms:"[me:true]"}, function(data) {
        if(!data || !data.length) return;
        csv = "lat,lon,value\n";
        var p = {};
        data.forEach(function(place){
          var ndx = place.lat.toFixed(2) + "," + place.lng.toFixed(2);
          p[ndx] = (p[ndx]) ? p[ndx]+1 : 1;
        });
    Object.keys(p).forEach(function(k){
            csv += k + "," + p[k] + "\n";

    });
  drawMap();
    });
})
function onMapCreated()
{
    map = $.getOpenHeatMap();
  drawMap();
}
function drawMap(){
  if(!map || !csv) return;
console.log("loading ");
    map.loadWaysFromFile('http://static.openheatmap.com/world_countries.osm');
    map.loadValuesFromCSVString(csv);
    map.setSetting('show_map_tiles', true);
    createGradientFromSettings();

}
</script>
</head>
<body>
<div id="openheatmap_container"></div>
</body>
</html>
